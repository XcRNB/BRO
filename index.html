<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>BRO</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui;}
body{background:#000;padding:8px;}
.app{background:#fff;border:2px solid #000;padding:15px;max-width:100%;}
.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
#key{width:100%;padding:14px;font-size:18px;border:2px solid #000;margin-bottom:12px;}
.show{border:2px solid #000;padding:18px;text-align:center;margin-bottom:15px;}
.show div:first-child{font-size:36px;font-weight:700;}
.show div:last-child{font-size:28px;font-family:monospace;}
.hide{display:none;}
.admin-item{display:flex;align-items:center;gap:6px;margin-bottom:6px;}
.admin-item input{flex:1;border:2px solid #000;padding:8px;font-size:14px;}
.admin-item div{display:flex;gap:4px;}
.btn{background:#fff;border:2px solid #000;padding:10px 14px;font-weight:600;font-size:15px;}
.btn-dark{background:#000;color:#fff;}
#adminList{margin-bottom:15px;}
</style>
</head>
<body>
<div class="app">
  <div class="top"><h2>账号</h2><button class="btn" id="adminBtn">后台</button></div>
  
  <div id="f">
    <input id="key" placeholder="输入编号" autofocus>
    <div class="show" id="res"><div>-</div><div>-</div></div>
  </div>
  
  <div id="b" class="hide">
    <div class="top"><h2>后台管理</h2><button class="btn" id="backBtn">返回</button></div>
    <div id="adminList"></div>
    <div style="display:flex;gap:6px;margin-top:5px;">
      <input id="nid" placeholder="编号" style="flex:1;border:2px solid #000;padding:10px;">
      <input id="nnm" placeholder="姓名" style="flex:1;border:2px solid #000;padding:10px;">
      <input id="nps" placeholder="密码" style="flex:1;border:2px solid #000;padding:10px;">
      <button class="btn btn-dark" id="addBtn">增加</button>
    </div>
  </div>
</div>

<script>
let d=[];
let u=new URLSearchParams(location.search).get('d');
if(u) try{d=JSON.parse(decodeURIComponent(u));}catch(e){}
if(!d.length)d=[
  {id:"1001",name:"林静",pass:"lk4tQ9"},
  {id:"1003",name:"陈远",pass:"p55w0rd"},
  {id:"1005",name:"张岷",pass:"zx8mN3"},
  {id:"2002",name:"李宛",pass:"W9ets2"},
  {id:"2007",name:"赵柯",pass:"tkk921"},
  {id:"3014",name:"周屿",pass:"r1sT7"}
];

function sv(n){d=n;let e=encodeURIComponent(JSON.stringify(d));window.location.href=location.pathname+'?d='+e;}

function al(){
  let h='';
  d.forEach((v,i)=>{
    h+=`<div class="admin-item">
      <input id="id${i}" value="${v.id}">
      <input id="nm${i}" value="${v.name}">
      <input id="ps${i}" value="${v.pass}">
      <div><button class="btn" onclick="ed(${i})">存</button><button class="btn" onclick="de(${i})">删</button></div>
    </div>`;
  });
  document.getElementById('adminList').innerHTML=h;
}

window.ed=function(i){
  let id=document.getElementById(`id${i}`).value;
  let nm=document.getElementById(`nm${i}`).value;
  let ps=document.getElementById(`ps${i}`).value;
  if(id&&nm&&ps){let nd=[...d];nd[i]={id,name:nm,pass:ps};sv(nd);}
}
window.de=function(i){let nd=[...d];nd.splice(i,1);sv(nd);};

document.getElementById('key').oninput=function(){
  let v=this.value.trim(),x=d.find(d=>d.id===v);
  document.getElementById('res').innerHTML=v?x?`<div>${x.name}</div><div>${x.pass}</div>`:'<div>无</div><div>-</div>':'<div>-</div><div>-</div>';
};

// ✅ Git远程读取方式：从服务器获取password.json
let c=0;
document.getElementById('adminBtn').onclick=async function(e){
  e.preventDefault();c++;
  if(c==3){
    try {
      let res=await fetch('password.json');
      let data=await res.json();
      let p=prompt('后台密码');
      if(p===data.admin){
        document.getElementById('f').classList.add('hide');
        document.getElementById('b').classList.remove('hide');
        al();
      } else alert('密码错误');
    } catch(err){
      alert('读取password.json失败，请确认: \n1. 文件在同目录\n2. 已上传到GitHub\n3. 文件名完全一致');
    }
    c=0;
  }
};

document.getElementById('backBtn').onclick=function(e){
  e.preventDefault();
  document.getElementById('b').classList.add('hide');
  document.getElementById('f').classList.remove('hide');
};

document.getElementById('addBtn').onclick=function(){
  let id=document.getElementById('nid').value,nm=document.getElementById('nnm').value,ps=document.getElementById('nps').value;
  if(id&&nm&&ps){
    if(d.find(v=>v.id===id)){alert('编号已存在');return;}
    let nd=[...d];nd.push({id,name:nm,pass:ps});sv(nd);
  }
};
</script>
</body>
      </html>
